<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>결제 실패 - Biz-Retriever</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/main.css">
    
    <style>
        body {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .fail-container {
            background: white;
            border-radius: var(--radius-lg);
            padding: 3rem;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .fail-icon {
            width: 80px;
            height: 80px;
            background: var(--error-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            animation: shake 0.5s ease-out;
        }

        .fail-icon::after {
            content: "✕";
            color: white;
            font-size: 3rem;
            font-weight: bold;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .fail-container h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .fail-message {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .error-details {
            background: #fff5f5;
            border-left: 4px solid var(--error-color);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: left;
        }

        .error-details h3 {
            font-size: 0.9rem;
            color: var(--error-color);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .error-details p {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .error-code {
            font-family: monospace;
            background: white;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            color: var(--error-color);
        }

        .btn-group {
            display: flex;
            gap: 1rem;
        }

        .btn-group .btn {
            flex: 1;
        }

        .help-text {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .help-text a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .help-text a:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <div class="fail-container">
        <div class="fail-icon"></div>
        <h1>결제에 실패했습니다</h1>
        <p class="fail-message">
            결제 처리 중 문제가 발생했습니다.<br>
            아래 오류 정보를 확인하신 후 다시 시도해주세요.
        </p>

        <div class="error-details">
            <h3>오류 정보</h3>
            <p id="error-message">오류 메시지를 불러오는 중...</p>
            <div class="error-code" id="error-code">-</div>
        </div>

        <div class="btn-group">
            <button class="btn btn-outline" onclick="window.location.href='dashboard.html'">
                대시보드로 이동
            </button>
            <button class="btn btn-primary" onclick="retryPayment()">
                다시 시도
            </button>
        </div>

        <div class="help-text">
            문제가 계속되면 <a href="mailto:support@biz-retriever.com">고객지원</a>으로 문의하세요.
        </div>
    </div>

    <script>
        let failedPlan = null;

        window.addEventListener('DOMContentLoaded', () => {
            // Extract error info from URL
            const urlParams = new URLSearchParams(window.location.search);
            const errorCode = urlParams.get('code');
            const errorMessage = urlParams.get('message');
            const orderId = urlParams.get('orderId');

            // Try to extract plan from orderId (format: BIZ-{user_id}-{PLAN}-{timestamp})
            if (orderId) {
                const parts = orderId.split('-');
                if (parts.length >= 3) {
                    failedPlan = parts[2].toLowerCase();
                }
            }

            // Display error information
            if (errorMessage) {
                document.getElementById('error-message').textContent = decodeURIComponent(errorMessage);
            } else {
                document.getElementById('error-message').textContent = '알 수 없는 오류가 발생했습니다.';
            }

            if (errorCode) {
                document.getElementById('error-code').textContent = `오류 코드: ${errorCode}`;
            } else {
                document.getElementById('error-code').textContent = '오류 코드: UNKNOWN';
            }

            // Common error translations
            const errorTranslations = {
                'INVALID_CARD_NUMBER': '카드 번호가 올바르지 않습니다',
                'INVALID_EXPIRY': '유효기간이 올바르지 않습니다',
                'INVALID_CVC': 'CVC 번호가 올바르지 않습니다',
                'INSUFFICIENT_FUNDS': '잔액이 부족합니다',
                'CARD_EXPIRED': '카드가 만료되었습니다',
                'USER_CANCEL': '사용자가 결제를 취소했습니다',
                'TIMEOUT': '결제 요청 시간이 초과되었습니다'
            };

            if (errorCode && errorTranslations[errorCode]) {
                document.getElementById('error-message').textContent = errorTranslations[errorCode];
            }
        });

        function retryPayment() {
            // Redirect to payment page with pre-selected plan if available
            if (failedPlan) {
                window.location.href = `payment.html?plan=${failedPlan}`;
            } else {
                window.location.href = 'payment.html';
            }
        }
    </script>
</body>

</html>
