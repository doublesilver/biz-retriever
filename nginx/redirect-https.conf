# ============================================
# Nginx HTTP to HTTPS Redirect Configuration
# ============================================
#
# 목적: 모든 HTTP 요청을 HTTPS로 자동 리다이렉트
# 
# 사용 방법:
# 1. Nginx Proxy Manager UI에서 자동 처리 (권장)
#    - Proxy Host 편집 → SSL 탭 → "Force SSL" 활성화
# 
# 2. 또는 이 파일을 nginx.conf에 include:
#    include /etc/nginx/redirect-https.conf;
#
# 3. 또는 Nginx Proxy Manager의 "Advanced" 탭에 복사

# ============================================
# HTTP 서버 블록 - HTTPS로 리다이렉트
# ============================================
server {
    # HTTP 포트 (80) 수신
    listen 80;
    listen [::]:80;
    
    # 도메인 설정
    server_name leeeunseok.tail32c3e2.ts.net;
    
    # 모든 요청을 HTTPS로 리다이렉트
    # $host: 요청한 호스트명 (Host 헤더)
    # $request_uri: 전체 요청 URI (쿼리 문자열 포함)
    # 301: Permanent Redirect (검색 엔진이 HTTPS로 업데이트)
    return 301 https://$host$request_uri;
}

# ============================================
# 리다이렉트 동작 예시
# ============================================
#
# 요청: http://leeeunseok.tail32c3e2.ts.net/api/v1/bids?page=1
# 응답: 301 Moved Permanently
#       Location: https://leeeunseok.tail32c3e2.ts.net/api/v1/bids?page=1
#
# 요청: http://leeeunseok.tail32c3e2.ts.net/
# 응답: 301 Moved Permanently
#       Location: https://leeeunseok.tail32c3e2.ts.net/

# ============================================
# 검증 명령어
# ============================================
#
# HTTP 리다이렉트 확인:
# curl -I http://leeeunseok.tail32c3e2.ts.net
#
# 예상 출력:
# HTTP/1.1 301 Moved Permanently
# Location: https://leeeunseok.tail32c3e2.ts.net/
#
# 리다이렉트 따라가기:
# curl -L http://leeeunseok.tail32c3e2.ts.net
#
# 상세 정보 확인:
# curl -v http://leeeunseok.tail32c3e2.ts.net 2>&1 | head -20

# ============================================
# 주의사항
# ============================================
#
# 1. 301 vs 302 리다이렉트
#    - 301: Permanent (검색 엔진이 HTTPS로 업데이트, 캐시됨)
#    - 302: Temporary (매번 리다이렉트 확인)
#    → HTTPS는 영구적이므로 301 사용
#
# 2. 성능 영향
#    - 리다이렉트는 추가 왕복(round-trip) 발생
#    - HSTS 헤더로 브라우저 캐시 후 리다이렉트 생략
#
# 3. 모바일 앱
#    - 모바일 앱은 리다이렉트 미지원 가능
#    - API 클라이언트는 HTTPS URL 직접 사용 권장
