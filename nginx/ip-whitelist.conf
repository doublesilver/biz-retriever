# IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸/ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì„¤ì •
# ê´€ë¦¬ì í˜ì´ì§€ ì ‘ê·¼ ì œì–´ ë° ì•Œë ¤ì§„ ì•…ì„± IP ì°¨ë‹¨

# ============================================
# ê´€ë¦¬ì IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸
# ============================================
# /admin ê²½ë¡œëŠ” íŠ¹ì • IPì—ì„œë§Œ ì ‘ê·¼ í—ˆìš©

# ì‚¬ìš© ì˜ˆì‹œ (server ë˜ëŠ” location ë¸”ë¡):
# location /admin {
#     # ì‚¬ë¬´ì‹¤ IP í—ˆìš©
#     allow 211.xxx.xxx.xxx;
#     
#     # ì§‘ IP í—ˆìš©
#     allow 121.xxx.xxx.xxx;
#     
#     # Localhost í—ˆìš© (ê°œë°œ/í…ŒìŠ¤íŠ¸)
#     allow 127.0.0.1;
#     allow ::1;
#     
#     # ë‚˜ë¨¸ì§€ ëª¨ë‘ ì°¨ë‹¨
#     deny all;
#     
#     proxy_pass http://backend;
# }

# ============================================
# ì•Œë ¤ì§„ ì•…ì„± IP ë¸”ë™ë¦¬ìŠ¤íŠ¸
# ============================================
# ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€í•˜ê±°ë‚˜ ìŠ¤í¬ë¦½íŠ¸ë¡œ ìë™ ì—…ë°ì´íŠ¸

# ë¸”ë™ë¦¬ìŠ¤íŠ¸ ë§µ ì •ì˜
geo $blocked_ip {
    default 0;
    
    # ì˜ˆì‹œ: ì•Œë ¤ì§„ ê³µê²© IP (ì‹¤ì œ IPë¡œ êµì²´)
    # 1.2.3.4 1;
    # 5.6.7.8 1;
    
    # IP ë²”ìœ„ ì°¨ë‹¨ ì˜ˆì‹œ
    # 192.168.1.0/24 1;
}

# ì ìš© (server ë¸”ë¡):
# if ($blocked_ip) {
#     return 403;
# }

# ============================================
# êµ­ê°€ë³„ ì ‘ê·¼ ì œì–´ (GeoIP í•„ìš”)
# ============================================
# GeoIP ëª¨ë“ˆ ì„¤ì¹˜ í•„ìš”: nginx-module-geoip
# 
# ì˜ˆì‹œ:
# geo $allowed_country {
#     default no;
#     KR yes;  # í•œêµ­ë§Œ í—ˆìš©
#     US yes;  # ë¯¸êµ­ í—ˆìš©
# }
# 
# if ($allowed_country = no) {
#     return 403;
# }

# ============================================
# ë™ì  ë¸”ë™ë¦¬ìŠ¤íŠ¸ (Fail2Ban ì—°ë™)
# ============================================
# Fail2Banì´ ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” íŒŒì¼ include

# ì‚¬ìš© ì˜ˆì‹œ:
# include /etc/nginx/conf.d/blocklist.conf;
# 
# Fail2Banì´ /etc/nginx/conf.d/blocklist.conf íŒŒì¼ì—
# ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ìë™ ì¶”ê°€:
#   deny 1.2.3.4;
#   deny 5.6.7.8;

# ============================================
# Fail2Ban ì„¤ì • (/etc/fail2ban/jail.local)
# ============================================
# [nginx-limit-req]
# enabled = true
# filter = nginx-limit-req
# action = nginx-blocklist
# logpath = /var/log/nginx/error.log
# findtime = 600
# maxretry = 5
# bantime = 3600
# 
# ì„¤ëª…:
#   - findtime: 10ë¶„ ë™ì•ˆ
#   - maxretry: 5íšŒ ì´ìƒ Rate Limit ì´ˆê³¼ ì‹œ
#   - bantime: 1ì‹œê°„ ë™ì•ˆ ì°¨ë‹¨

# ============================================
# Nginx ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì•¡ì…˜ (/etc/fail2ban/action.d/nginx-blocklist.conf)
# ============================================
# [Definition]
# actionstart = 
# actionstop = 
# actioncheck = 
# 
# actionban = echo "deny <ip>;" >> /etc/nginx/conf.d/blocklist.conf
#             nginx -s reload
# 
# actionunban = sed -i '/deny <ip>;/d' /etc/nginx/conf.d/blocklist.conf
#               nginx -s reload

# ============================================
# ìˆ˜ë™ IP ì°¨ë‹¨ ìŠ¤í¬ë¦½íŠ¸
# ============================================
# íŒŒì¼: scripts/block-ip.sh
# 
# #!/bin/bash
# IP=$1
# BLOCKLIST="/etc/nginx/conf.d/blocklist.conf"
# 
# echo "deny $IP;" >> $BLOCKLIST
# nginx -s reload
# echo "âœ… Blocked IP: $IP"
# 
# # Slack ì•Œë¦¼ (ì„ íƒì‚¬í•­)
# curl -X POST $SLACK_WEBHOOK_URL \
#   -H 'Content-Type: application/json' \
#   -d "{\"text\":\"ğŸš« IP Blocked: $IP\"}"

# ============================================
# IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ìš°ì„ ìˆœìœ„
# ============================================
# NginxëŠ” allow/denyë¥¼ ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬:
# 1. ì²« ë²ˆì§¸ ë§¤ì¹­ë˜ëŠ” ê·œì¹™ ì ìš©
# 2. allowê°€ ë¨¼ì € ë‚˜ì˜¤ë©´ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ìš°ì„ 
# 3. denyê°€ ë¨¼ì € ë‚˜ì˜¤ë©´ ë¸”ë™ë¦¬ìŠ¤íŠ¸ ìš°ì„ 
# 
# ê¶Œì¥ ìˆœì„œ:
# allow <specific IP>;  # í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸
# deny <specific IP>;   # ë¸”ë™ë¦¬ìŠ¤íŠ¸
# allow all;            # ë‚˜ë¨¸ì§€ í—ˆìš©
# ë˜ëŠ”
# deny all;             # ë‚˜ë¨¸ì§€ ì°¨ë‹¨

# ============================================
# ëª¨ë‹ˆí„°ë§
# ============================================
# ì°¨ë‹¨ëœ IP í™•ì¸:
#   grep "403" /var/log/nginx/access.log | awk '{print $1}' | sort | uniq -c | sort -rn
# 
# Top 10 ì°¨ë‹¨ IP:
#   tail -10000 /var/log/nginx/access.log | grep "403" | awk '{print $1}' | sort | uniq -c | sort -rn | head -10
