# ============================================
# Nginx Security Headers Configuration
# ============================================
# 
# 이 파일은 보안 헤더를 설정합니다.
# Nginx Proxy Manager의 "Advanced" 탭에서 사용하거나,
# 메인 nginx.conf에 include하여 사용합니다.
#
# 사용 방법:
# 1. Nginx Proxy Manager UI에서 Proxy Host 편집
# 2. "Advanced" 탭 → "Custom Nginx Configuration"에 아래 내용 복사
# 3. 또는 nginx.conf에서: include /etc/nginx/security-headers.conf;

# ============================================
# 1. HSTS (HTTP Strict-Transport-Security)
# ============================================
# 목적: 브라우저에 HTTPS만 사용하도록 강제
# 효과: 중간자 공격(MITM) 방지, 다운그레이드 공격 방지
# 
# max-age=31536000: 1년(31536000초) 동안 HTTPS 강제
# includeSubDomains: 서브도메인도 HSTS 적용
# always: 모든 응답(에러 포함)에 헤더 추가
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

# ============================================
# 2. X-Frame-Options
# ============================================
# 목적: Clickjacking 공격 방지
# 효과: 악의적인 사이트에서 iframe으로 페이지 임베드 불가
#
# SAMEORIGIN: 같은 도메인의 프레임만 허용 (권장)
# DENY: 모든 프레임 차단
# ALLOW-FROM uri: 특정 도메인만 허용 (구식, 권장 안 함)
add_header X-Frame-Options "SAMEORIGIN" always;

# ============================================
# 3. X-Content-Type-Options
# ============================================
# 목적: MIME 타입 스니핑 방지
# 효과: 브라우저가 Content-Type 헤더를 무시하고 파일 타입 추측 불가
#
# nosniff: MIME 타입 스니핑 비활성화
# 예: .js 파일을 .html로 제공해도 JavaScript로 실행 안 됨
add_header X-Content-Type-Options "nosniff" always;

# ============================================
# 4. X-XSS-Protection
# ============================================
# 목적: XSS(Cross-Site Scripting) 공격 방지
# 효과: 구형 브라우저의 XSS 필터 활성화
#
# 1; mode=block: XSS 감지 시 페이지 로드 차단
# 참고: 최신 브라우저는 CSP(Content-Security-Policy) 권장
add_header X-XSS-Protection "1; mode=block" always;

# ============================================
# 5. Referrer-Policy
# ============================================
# 목적: Referrer 정보 노출 제한
# 효과: 사용자 프라이버시 보호, 민감한 URL 정보 유출 방지
#
# strict-origin-when-cross-origin: 
#   - 같은 도메인: 전체 URL 전송
#   - 다른 도메인: 도메인만 전송 (HTTPS → HTTPS만)
#   - HTTP → HTTPS: Referrer 전송 안 함
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# ============================================
# 6. Permissions-Policy (Feature-Policy)
# ============================================
# 목적: 브라우저 기능 접근 제한
# 효과: 악의적인 스크립트가 민감한 기능 사용 불가
#
# geolocation=(): 위치 정보 접근 차단
# microphone=(): 마이크 접근 차단
# camera=(): 카메라 접근 차단
# 
# 추가 옵션:
# - payment=(): 결제 API 차단
# - usb=(): USB 접근 차단
# - magnetometer=(): 자기계 센서 차단
# - gyroscope=(): 자이로스코프 차단
# - accelerometer=(): 가속도계 차단
add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;

# ============================================
# 추가 권장 헤더 (선택사항)
# ============================================

# Content-Security-Policy (CSP)
# 목적: XSS, 클릭재킹, 데이터 인젝션 공격 방지
# 주의: 너무 제한적이면 정상 기능 차단 가능
# add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';" always;

# X-Permitted-Cross-Domain-Policies
# 목적: Flash/PDF 크로스 도메인 정책 제한
# add_header X-Permitted-Cross-Domain-Policies "none" always;

# ============================================
# 검증 명령어
# ============================================
# 
# 헤더 확인:
# curl -I https://leeeunseok.tail32c3e2.ts.net
#
# 특정 헤더만 확인:
# curl -I https://leeeunseok.tail32c3e2.ts.net | grep -i "strict-transport-security"
#
# 모든 보안 헤더 확인:
# curl -I https://leeeunseok.tail32c3e2.ts.net | grep -E "strict-transport-security|x-frame-options|x-content-type-options|x-xss-protection|referrer-policy|permissions-policy"
