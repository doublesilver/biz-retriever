# ==========================================================
# Auto Format Code with Ruff
# ==========================================================
# 학습 노트:
#
# 코드 자동 포맷팅이란?
# 코드 스타일을 통일해주는 자동화 도구입니다.
# 예: 들여쓰기, 따옴표 스타일, import 순서 등을 자동으로 맞춰줍니다.
#
# Ruff를 선택한 이유:
# - Black + isort + flake8을 하나로 통합 (설치/실행 1개만)
# - Rust로 작성되어 100배 이상 빠름
# - pyproject.toml에서 설정 통합 관리
# ==========================================================

name: Auto Format Code

on:
  push:
    branches: [master, main]
    paths:
      - "**.py"

permissions:
  contents: write

jobs:
  format:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install Ruff
        run: pip install ruff==0.6.0

      - name: Format with Ruff
        run: |
          ruff check --fix app/ tests/ || true
          ruff format app/ tests/

      - name: Commit changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git diff --quiet && git diff --staged --quiet || (git add -A && git commit -m "style: auto-format with ruff")

      - name: Push changes
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ github.ref }}
